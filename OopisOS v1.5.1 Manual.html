<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OopisOS - The Educational Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #18181b; /* zinc-900 */
            color: #e4e4e7; /* zinc-200 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .nav-link {
            transition: all 0.3s ease;
        }
        .nav-link.active, .nav-link:hover {
            background-color: #3f3f46; /* zinc-700 */
            color: #a7f3d0; /* emerald-200 */
        }
        h1, h2, h3, h4 {
            font-family: 'VT323', monospace;
            letter-spacing: 0.05em;
        }
        h1 { color: #34d399; /* emerald-400 */ }
        h2 { color: #60a5fa; /* blue-400 */ border-bottom: 1px solid #52525b; /* zinc-600 */ padding-bottom: 0.25rem; margin-top: 1.5rem; margin-bottom: 1rem; }
        h3 { color: #facc15; /* yellow-400 */ margin-top: 1rem; margin-bottom: 0.5rem; }
        h4 { color: #fb923c; /* orange-400 */ margin-top: 0.75rem; margin-bottom: 0.25rem; }
        p, li, table { line-height: 1.7; }
        a { color: #2dd4bf; /* teal-400 */ text-decoration: underline; }
        a:hover { color: #5eead4; /* teal-300 */ }
        pre {
            background-color: #27272a; /* zinc-800 */
            color: #d4d4d8; /* zinc-300 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'VT323', monospace;
            font-size: 0.875rem; /* text-sm */
            line-height: 1.5;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }
        code {
            font-family: 'VT323', monospace;
            background-color: #3f3f46; /* zinc-700 */
            color: #fde047; /* yellow-300 */
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.9em;
        }
        pre code {
            padding: 0;
            background-color: transparent;
            color: inherit;
        }
        .sidebar {
            background-color: #27272a; /* zinc-800 */
        }
        .main-content {
            background-color: #18181b; /* zinc-900 */
        }
        .logo {
            font-family: 'VT323', monospace;
            color: #34d399; /* emerald-400 */
        }
        table {
            width: 100%;
            margin-top: 1rem;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #52525b; /* zinc-600 */
            padding: 0.75rem;
            text-align: left;
        }
        th {
            background-color: #3f3f46; /* zinc-700 */
            font-family: 'VT323', monospace;
            color: #a7f3d0; /* emerald-200 */
        }
        ul { list-style-type: disc; margin-left: 1.5rem; }
        .terminal-example {
            background-color: #0d0d0d; /* darker than zinc-950 */
            border: 2px solid #3f3f46; /* zinc-700 */
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            box-shadow: inset 0 0 10px rgba(0, 255, 0, 0.1);
        }
        .terminal-example .prompt { color: #60a5fa; /* blue-400 */ }
        .terminal-example .command { color: #a7f3d0; /* emerald-200 */ }
        .terminal-example .output { color: #e4e4e7; /* zinc-200 */ white-space: pre-wrap; }
        .footer {
            border-top: 1px solid #52525b; /* zinc-600 */
            padding-top: 1rem;
            margin-top: 2rem;
            font-size: 0.875rem;
            color: #a1a1aa; /* zinc-400 */
        }
        /* Mobile Menu Button */
        #menu-button {
            display: none; /* Hidden by default */
        }
        @media (max-width: 768px) {
            #menu-button {
                display: block; /* Show on mobile */
            }
            .sidebar {
                display: none; /* Hide sidebar by default on mobile */
                width: 100%;
                height: auto;
                position: static;
            }
            .sidebar.open {
                display: block; /* Show when open */
            }
            .flex {
                flex-direction: column;
            }
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="flex flex-col md:flex-row min-h-screen">
        <button id="menu-button" class="md:hidden p-4 bg-zinc-800 text-emerald-400 fixed top-0 left-0 z-20">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
        </button>

        <aside class="sidebar w-full md:w-64 lg:w-72 p-6 space-y-4 fixed md:sticky top-0 h-screen overflow-y-auto z-10">
            <h1 class="logo text-4xl mb-6">OopisOS</h1>
            <nav>
                <ul class="space-y-2">
                    <li><a href="#home" class="nav-link block p-3 rounded-lg active">Home & Overview</a></li>
                    <li><a href="#user-guide" class="nav-link block p-3 rounded-lg">User Guide</a></li>
                    <li><a href="#how-it-works" class="nav-link block p-3 rounded-lg">How It Works</a></li>
                    <li><a href="#developer-docs" class="nav-link block p-3 rounded-lg">Developer Docs</a></li>
                    <li><a href="#advanced-topics" class="nav-link block p-3 rounded-lg">Advanced Topics</a></li>
                    <li><a href="#about" class="nav-link block p-3 rounded-lg">About & Credits</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content flex-1 p-6 md:p-10 overflow-y-auto mt-16 md:mt-0">
            <section id="home" class="content-section active">
                <h1>Welcome to OopisOS!</h1>
                <p class="text-lg mt-2 mb-6 text-zinc-400">The little browser-based Operating System that could (and does!).</p>

                <div class="terminal-example">
                    <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">echo "Hello, OopisOS World!"</span><br>
                    <span class="output">Hello, OopisOS World!</span>
                </div>

                <h2>What is OopisOS?</h2>
                <p>OopisOS (v1.5.1) is a fully persistent, self-contained operating system simulation that runs entirely within your web browser. Born from a collaborative effort between Andrew Edmark and Gemini Pro 2.5, it aims to recreate the feel and functionality of a classic command-line interface (CLI) environment, complete with a hierarchical file system, user management, a powerful text editor, and a suite of useful commands.</p>
                <p>It's an educational tool, a nostalgic playground, and a testament to what can be achieved with JavaScript, IndexedDB for persistence, and a lot of creative coding.</p>

                <h2>Core Philosophy</h2>
                <ul class="list-disc ml-6 space-y-2 my-4">
                    <li><strong>Persistence is Key:</strong> Your files, user accounts, and session states are saved using IndexedDB, meaning your work remains even after closing the browser tab.</li>
                    <li><strong>Self-Contained:</strong> Everything runs client-side. No server needed (beyond serving the initial HTML/JS).</li>
                    <li><strong>Educational & Fun:</strong> Designed to be a learning experience for those interested in OS concepts, CLI interactions, and JavaScript module architecture.</li>
                    <li><strong>Extensible:</strong> Built with modularity in mind, making it possible for developers to contribute new commands and features.</li>
                    <li><strong>POSIX-ish Familiarity:</strong> While not a strict POSIX implementation, many commands and concepts will feel familiar to users of Unix-like systems.</li>
                </ul>

                <h2>Key Features at a Glance</h2>
                <ul class
="list-disc ml-6 space-y-2 my-4">
                    <li><strong>Persistent File System:</strong> Create, edit, move, copy, and delete files and directories. Stored in IndexedDB.</li>
                    <li><strong>Command-Line Interface:</strong> A retro-styled terminal with command history, tab completion, piping, and I/O redirection.</li>
                    <li><strong>User Management:</strong> Register multiple users, log in/out, and manage file ownership and permissions.</li>
                    <li><strong>Integrated Text Editor:</strong> A surprisingly powerful in-OS text editor (`edit` command) with syntax highlighting (for Markdown/HTML via preview), line numbers, word wrap, and split-view preview for Markdown and HTML.</li>
                    <li><strong>Scripting:</strong> Write and execute shell scripts using the `run` command, with argument passing and comment support.</li>
                    <li><strong>Session Management:</strong> Automatic session saving and loading per user, plus manual save/load state options.</li>
                    <li><strong>File Operations:</strong> Includes `ls`, `cd`, `pwd`, `mkdir`, `rm`, `mv`, `cp`, `cat`, `touch`, `find`, `grep`, `tree`.</li>
                    <li><strong>Permissions:</strong> Basic file and directory permissions (`chmod`, `chown`).</li>
                    <li><strong>Import/Export:</strong> `upload` files from your computer into OopisOS, and `export` files from OopisOS to your computer. Full file system `backup` and `restore` also available.</li>
                </ul>
                <p>Dive in, explore, and see what you can create in the world of OopisOS!</p>
            </section>

            <section id="user-guide" class="content-section">
                <h1>OopisOS User Guide</h1>
                <p>Welcome to your OopisOS journey! This guide will help you get started with the basics.</p>

                <h2>The Terminal Interface</h2>
                <p>OopisOS presents a classic terminal interface. Here's what you'll see:</p>
                <div class="terminal-example">
                    <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">_</span>
                </div>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Prompt:</strong> Shows `username@hostname:current_path&gt;`. For example, <code>Guest@OopisOs:/&gt;</code>.</li>
                    <li><strong>Input Area:</strong> Where you type your commands.</li>
                    <li><strong>Output Area:</strong> Where command results and messages appear.</li>
                </ul>

                <h2>Essential Commands</h2>
                <p>Here are some fundamental commands to get you started. For a full list, type <code>help</code>. For help on a specific command, type <code>help [command_name]</code>.</p>
                <table class="min-w-full divide-y divide-zinc-700">
                    <thead>
                        <tr>
                            <th class="px-4 py-2">Command</th>
                            <th class="px-4 py-2">Description</th>
                            <th class="px-4 py-2">Example</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-zinc-800">
                        <tr><td><code>help</code></td><td>Displays available commands or help for a specific command.</td><td><code>help ls</code></td></tr>
                        <tr><td><code>ls</code></td><td>Lists directory contents. Use <code>ls -l</code> for details, <code>ls -a</code> for hidden files.</td><td><code>ls -l /docs</code></td></tr>
                        <tr><td><code>cd [directory]</code></td><td>Changes the current directory.</td><td><code>cd /docs</code></td></tr>
                        <tr><td><code>pwd</code></td><td>Prints the current working directory path.</td><td><code>pwd</code></td></tr>
                        <tr><td><code>mkdir [directory_name]</code></td><td>Creates a new directory. Use <code>-p</code> to create parent directories.</td><td><code>mkdir my_new_folder</code></td></tr>
                        <tr><td><code>cat [file_path]</code></td><td>Displays the content of a file.</td><td><code>cat /README.md</code></td></tr>
                        <tr><td><code>echo [text]</code></td><td>Displays text or writes it to a file using redirection.</td><td><code>echo "Hello" > /greeting.txt</code></td></tr>
                        <tr><td><code>edit [file_path]</code></td><td>Opens a file in the built-in text editor. Creates the file if it doesn't exist.</td><td><code>edit my_notes.txt</code></td></tr>
                        <tr><td><code>touch [file_path]</code></td><td>Creates an empty file or updates the timestamp of an existing file/directory.</td><td><code>touch newfile.dat</code></td></tr>
                        <tr><td><code>rm [file_or_directory]</code></td><td>Removes a file. Use <code>-r</code> for directories. Use with caution!</td><td><code>rm old_file.txt</code></td></tr>
                        <tr><td><code>cp [source] [destination]</code></td><td>Copies files or directories. Use <code>-r</code> for directories.</td><td><code>cp file.txt backup/file.bak</code></td></tr>
                        <tr><td><code>mv [source] [destination]</code></td><td>Moves or renames files or directories.</td><td><code>mv old_name.txt new_name.txt</code></td></tr>
                        <tr><td><code>whoami</code></td><td>Displays your current username.</td><td><code>whoami</code></td></tr>
                        <tr><td><code>clear</code></td><td>Clears the terminal screen.</td><td><code>clear</code></td></tr>
                    </tbody>
                </table>

                <h2>The File System</h2>
                <p>OopisOS has a hierarchical file system, much like Linux or macOS.</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li>The root directory is <code>/</code>.</li>
                    <li>Paths are separated by <code>/</code>.</li>
                    <li><code>.</code> refers to the current directory.</li>
                    <li><code>..</code> refers to the parent directory.</li>
                    <li>Hidden files and directories start with a <code>.</code> (e.g., <code>.config</code>).</li>
                </ul>
                <p>You can navigate using <code>cd</code>, list contents with <code>ls</code>, and create directories with <code>mkdir</code>.</p>

                <h2>The Editor (`edit` command)</h2>
                <p>OopisOS includes a powerful text editor accessible via the <code>edit</code> command.</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Modes:</strong> Supports plain text, Markdown, and HTML (with preview). Mode is auto-detected by file extension (<code>.md</code>, 
<code>.html</code>, <code>.htm</code>).</li>
                    <li><strong>Controls:</strong>
                        <ul>
                            <li><code>Ctrl+S</code>: Save and Exit</li>
                            <li><code>Ctrl+O</code>: Exit (will confirm if there are unsaved changes)</li>
                            <li><code>Ctrl+P</code>: Toggle Preview (Split, Edit Only, Preview Only for Markdown/HTML)</li>
                        </ul>
                    </li>
                    <li><strong>Features:</strong> Line numbers, status bar (lines, words, chars, cursor position), word wrap toggle, export HTML preview.</li>
                </ul>
                <div class="terminal-example">
                    <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">edit my_story.md</span><br>
                    <span class="output">(Editor interface appears)</span>
                </div>

                <h2>Users and Permissions</h2>
                <p>OopisOS supports multiple users. Each file and directory has an owner and permissions.</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><code>register [username]</code>: Create a new user.</li>
                    <li><code>login [username]</code>: Log in as an existing user.</li>
                    <li><code>logout</code>: Log out and return to the Guest user.</li>
                    <li><code>whoami</code>: See your current username.</li>
                    <li><code>listusers</code>: Show all registered users.</li>
                    <li><code>chmod [mode] [path]</code>: Change permissions (e.g., <code>chmod 75 myfile</code> for rwxr-xr-x). Mode is two octal digits: first for owner, second for others. (4=read, 2=write, 1=execute).</li>
                    <li><code>chown [new_owner] [path]</code>: Change the owner of a file/directory (only current owner can do this).</li>
                </ul>
                <p>Permissions are displayed in <code>ls -l</code> output (e.g., <code>drwxr-xr-x</code>).</p>

                <h2>Pipes and Redirection</h2>
                <p>Like other shells, OopisOS supports piping and redirection:</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Pipes `|`</strong>: Send the output of one command as input to another.
                        <br>Example: <code>ls -a / | grep conf</code>
                    </li>
                    <li><strong>Output Redirection `>`</strong>: Write command output to a file (overwrites existing).
                        <br>Example: <code>echo "My data" > data.txt</code>
                    </li>
                    <li><strong>Output Redirection `>>`</strong>: Append command output to a file.
                        <br>Example: <code>date >> /system.log</code>
                    </li>
                </ul>
                <p>This is just the beginning! Explore the <code>help</code> command and experiment to discover all that OopisOS can do.</p>
            </section>

            <section id="how-it-works" class="content-section">
                <h1>OopisOS: Under The Hood</h1>
                <p>Curious about how OopisOS ticks? This section delves into the core architecture and key JavaScript modules that power this browser-based operating system.</p>

                <h2>Overall Architecture</h2>
                <p>OopisOS is a single-page application (SPA) built with vanilla JavaScript, structured into several key modules that manage different aspects of the OS simulation. It uses the browser's IndexedDB for persistent storage of file systems and user data, and localStorage for simpler session states and settings.</p>
                <p>The user interacts primarily through a terminal interface (<code>OopisOSv1_5_1.html</code> provides the structure), and commands are processed by a dedicated execution pipeline.</p>

                <h2>Core Modules (from <code>oopisos1_5_1.js</code>)</h2>

                <h3>1. `Config`</h3>
                <p>A global configuration object holding constants for database names, OS version, default user settings, CSS classes, editor settings, filesystem parameters, messages, and internal error codes. This centralizes settings for easy modification and consistency.</p>

                <h3>2. `Utils`</h3>
                <p>A collection of utility functions used throughout the OS, such as string formatting, object copying (<code>deepCopyNode</code>), byte formatting, file extension extraction, DOM element creation (<code>createElement</code>), argument validation, flag parsing (<code>parseFlags</code>), and glob pattern to regex conversion (<code>globToRegex</code>).</p>

                <h3>3. `TimestampParser`</h3>
                <p>Handles parsing of timestamp strings (like those used by the <code>touch -t</code> command) into standard ISO 8601 date strings. It supports formats like `[[CC]YY]MMDDhhmm[.ss]`.</p>

                <h3>4. `OutputManager`</h3>
                <p>Responsible for displaying text to the terminal's output area. It handles different message types (error, success, log), manages output when the editor is active, and overrides `console.log/warn/error` to redirect their output to the terminal.</p>

                <h3>5. `StorageManager`</h3>
                <p>A wrapper for `localStorage`, used for saving and loading simpler key-value data like user credentials (though these are just placeholder names for now) and editor settings (like word wrap preference).</p>

                <h3>6. `IndexedDBManager`</h3>
                <p>Manages the connection to the IndexedDB database (`OopisOsDB`). It initializes the database and the object store (`FileSystemsStore`) used by the `FileSystemManager` for persistent storage of entire file system structures for each user.</p>

                <h3>7. `FileSystemManager`</h3>
                <p>The heart of OopisOS's data storage. It simulates a hierarchical file system.</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Data Structure:</strong> The file system (<code>fsData</code>) is a JavaScript object where keys are absolute paths. Directory nodes contain a <code>type</code>, <code>children</code> (an object mapping names to child nodes), <code>owner</code>, <code>mode</code> (permissions), and <code>mtime</code> (modification time). File nodes contain <code>type</code>, <code>content</code>, <code>owner</code>, <code>mode</code>, and <code>mtime</code>.</li>
                    <li><strong>Persistence:</strong> User-specific file systems are saved to and loaded from IndexedDB via `IndexedDBManager`. Each user's FS is stored as a single object under a key like `fs_Guest`.</li>
                    <li><strong>Operations:</strong> Provides functions for path resolution (<code>getAbsolutePath</code>), node retrieval (<code>getNodeByPath</code>), creating parent directories (<code>createParentDirectoriesIfNeeded</code>), permission checking (<code>hasPermission</code>), and calculating node sizes.</li>
                    <li><strong>Initialization:</strong> When a new user is created or an existing user's FS is not found/corrupted, it initializes a new root directory structure.</li>
                    <li><strong>Metadata:</strong> Ensures all nodes have `owner`, `mode`, and `mtime` attributes, crucial for commands like `ls -l`, `chmod`, `chown`, and `find -mtime`.</li>
                </ul>

                <h3>8. `HistoryManager`</h3>
                <p>Manages the command history for the terminal. It allows users to navigate previous and next commands using arrow keys and stores a configurable number of commands.</p>

                <h3>9. `ConfirmationManager`</h3>
                <p>Handles user confirmations for potentially destructive operations (e.g., `rm -i`, `reset`, overwriting files during `upload` or `restore`). It displays a prompt and waits for a 'YES' input.</p>
                
                <h3>10. `EditorUtils`, `EditorUI`, `EditorManager`</h3>
                <p>These three modules work together to provide the in-OS text editor:</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>`EditorUtils`</strong>: Provides helper functions for the editor, such as determining file mode (text, markdown, html) based on extension, generating preview styling, calculating status bar information (lines, words, cursor position), and generating line numbers.</li>
                    <li><strong>`EditorUI`</strong>: Responsible for building, managing, and destroying the DOM elements of the editor interface. This includes the textarea, line gutter, preview pane, controls (filename, view toggle, export, word wrap), status bar, and instruction footer. It handles UI updates like filename display, status bar info, line numbers, word wrap application, and rendering previews (debounced for performance).</li>
                    <li><strong>`EditorManager`</strong>: The main controller for the editor. It orchestrates the editor's lifecycle:
                        <ul>
                            <li><code>enter()</code>: Initializes the editor, builds the UI (via `EditorUI`), loads content, sets up event handlers for input, scroll, selection changes, and keydown events (Tab, Ctrl+S, Ctrl+O, Ctrl+P).
                            </li>
                            <li><code>exit()</code>: Handles saving changes (if requested and permitted), prompts for discarding unsaved changes, and then cleans up the editor UI and restores the terminal interface.
                            </li>
                            <li>Manages editor state like `isActiveState`, `currentFilePath`, `currentFileMode`, `isDirty` (unsaved changes), `isWordWrapActive`, and `currentViewMode`.
                            </li>
                            <li>Handles editor-specific actions like toggling word wrap, toggling view modes, and exporting HTML previews.
                            </li>
                        </ul>
                    </li>
                </ul>

                <h3>11. `UserManager`</h3>
                <p>Manages user accounts. Users are currently "passwordless."</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li>Stores a list of registered usernames in `localStorage`.</li>
                    <li>Handles user registration (`register`), login (`login`), and logout (`logout`).</li>
                    <li>When a user logs in, their specific file system and session state are loaded.</li>
                </ul>

                <h3>12. `SessionManager`</h3>
                <p>Manages the saving and loading of user sessions to preserve the terminal state.</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Automatic State:</strong> Saves the current path, terminal output HTML, current input, and command history to `localStorage` when a user logs out or switches. This is loaded automatically on login.</li>
                    <li><strong>Manual State (`savestate`, `loadstate`):</strong> Allows users to manually save a more comprehensive snapshot of their session, including the entire file system data, to `localStorage`. Loading this requires confirmation.</li>
                    <li><strong>Full Reset (`reset`):</strong> Provides a way to clear all user credentials, session states, and file systems from both `localStorage` and `IndexedDB`.</li>
                </ul>

                <h3>13. `TabCompletionManager`</h3>
                <p>Provides tab completion functionality for command names and file/directory paths. It suggests completions based on the current input and context (e.g., if a command expects a path).</p>

                <h3>14. `CommandExecutor`</h3>
                <p>The engine that processes user input from the terminal.</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Lexer:</strong> A simple tokenizer that breaks the raw command string into a sequence of tokens (e.g., `WORD`, `STRING_DQ`, `OPERATOR_PIPE`). It recognizes quoted strings and basic operators.</li>
                    <li><strong>Parser:</strong> Takes the token stream from the Lexer and builds a `ParsedPipeline` object. This object represents one or more command segments connected by pipes, along with any I/O redirection or backgrounding requests.</li>
                    <li><strong>Command Dispatch:</strong> Iterates through the segments in a pipeline. For each segment, it looks up the command in its internal `commands` object and calls the command's `handler` function.</li>
                    <li><strong>Pipeline Execution (`_executePipeline`):</strong> Manages the flow of data (standard input/output) between commands in a pipeline. The output of one command becomes the `stdinContent` for the next.</li>
                    <li><strong>Redirection Handling:</strong> If output redirection (`>` or `>>`) is specified, it writes the final output of the pipeline to the specified file, creating/overwriting/appending as necessary and respecting basic permissions.</li>
                    <li><strong>Backgrounding (`&`):</strong> Allows commands to run "in the background" (simulated with `setTimeout`), with their output typically suppressed from the main terminal display.</li>
                    <li><strong>Command Definitions:</strong> Contains a large object where each key is a command name (e.g., `ls`, `cat`, `edit`) and the value is an object containing its `handler` function, `description`, and `helpText`.</li>
                    <li><strong>Script Execution (`run` command):</strong> The `run` command itself is handled here. It reads a script file, parses its lines (stripping comments, handling basic argument substitution like `$1`, `$@`, `$#`), and then executes each line as a new command via `processSingleCommand`.</li>
                </ul>

                <h3>15. Global Initialization (<code>window.onload</code>)</h3>
                <p>This function orchestrates the startup of OopisOS:</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li>Initializes `DOM` references to HTML elements.</li>
                    <li>Sets up console overrides via `OutputManager`.</li>
                    <li>Initializes `IndexedDBManager`.</li>
                    <li>Sets the default user via `UserManager`.</li>
                    <li>Loads the default user's file system (`FileSystemManager.load`) and session state (`SessionManager.loadAutomaticState`).</li>
                    <li>Attaches terminal event listeners for input, history navigation, and tab completion.</li>
                    <li>Focuses the terminal input.</li>
                </ul>

                <p>This modular design allows for relatively clean separation of concerns, making OopisOS (hopefully!) easier to understand, maintain, and extend.</p>
            </section>

            <section id="developer-docs" class="content-section">
                <h1>OopisOS Developer Documentation</h1>
                <p>Welcome, aspiring OopisOS contributor or module developer! This section provides insights into the codebase and how you can extend OopisOS.</p>

                <h2>Code Structure Overview</h2>
                <p>The primary logic for OopisOS resides in <code>oopisos1_5_1.js</code>. It's structured as a series of Immediately Invoked Function Expressions (IIFEs) that create modules, such as <code>FileSystemManager</code>, <code>CommandExecutor</code>, <code>UserManager</code>, etc. This helps encapsulate logic and avoid polluting the global namespace.</p>
                <p>Key modules and their roles are detailed in the "How It Works" section. Understanding these is crucial before diving into development.</p>
                <p>The main HTML file (<code>OopisOSv1_5_1.html</code>) provides the terminal structure and basic retro styling. Tailwind CSS is used for utility classes, and custom CSS handles the terminal's look and feel.</p>

                <h2>Contributing to OopisOS</h2>
                <p>While OopisOS is a project by Andrew Edmark and Gemini Pro 2.5, the spirit of open source and learning is encouraged!</p>
                <ol class="list-decimal ml-6 my-4 space-y-2">
                    <li><strong>Understand the Code:</strong> Familiarize yourself with the existing modules, especially 
                        <code>CommandExecutor</code>, <code>FileSystemManager</code>, and <code>Utils</code>.
                    </li>
                    <li><strong>Identify an Area:</strong> Want to fix a bug? Improve an existing command? Add a new command?
                    </li>
                    <li><strong>Modularity is Key:</strong> Try to keep new features or fixes well-contained within existing modules or by creating new, focused modules if necessary.
                    </li>
                    <li><strong>Follow Patterns:</strong> Observe how existing commands are defined in <code>CommandExecutor.commands</code>, how flags are parsed with <code>Utils.parseFlags</code>, and how file system interactions use <code>FileSystemManager.validatePath</code> and <code>FileSystemManager.hasPermission</code>.
                    </li>
                    <li><strong>User Experience:</strong> Ensure error messages are clear and helpful. Use <code>OutputManager.appendToOutput</code> with appropriate CSS classes from <code>Config.CSS_CLASSES</code>. For operations requiring confirmation, use the <code>ConfirmationManager</code>.</li>
                    <li><strong>Persistence:</strong> If your feature involves data that needs to persist, use <code>FileSystemManager.save()</code> after making changes to <code>fsData</code>. For session-specific data, consider if <code>SessionManager</code> needs updating.</li>
                    <li><strong>Testing:</strong>
                        <ul>
                            <li>Thoroughly test your changes. Consider edge cases.</li>
                            <li>The <code>diagnostic_tool1_5.sh</code> script provides a good example of how to write automated tests for OopisOS commands. Use it as inspiration or extend it.</li>
                            <li>The <code>inflatev4_1.sh</code> script is excellent for creating a diverse set of test data quickly.</li>
                        </ul>
                    </li>
                    <li><strong>Documentation:</strong> If adding a new command or significantly changing behavior, update its <code>description</code> and <code>helpText</code> in its command definition. Consider if this developer documentation needs updates too!</li>
                </ol>

                <h2>Developing New Commands</h2>
                <p>Adding a new command involves defining it within the <code>commands</code> object in the <code>CommandExecutor</code> module.</p>
                <pre><code class="language-javascript">
// Inside CommandExecutor IIFE, within the 'commands' object:
"yournewcommand": {
    handler: async (args, options) => {
        // args: An array of string arguments provided to your command.
        // options: An object containing:
        //   - isInteractive (boolean): True if run directly in terminal, false if from a script or pipe.
        //   - stdinContent (string|null): Input piped from a previous command.
        //   - explicitForce (boolean): True if -f or --force was among args (parsed by CommandExecutor).

        // 1. Validate arguments (e.g., using Utils.validateArguments)
        // const validationResult = Utils.validateArguments(args, { exact: 1 });
        // if (!validationResult.isValid) {
        //     return { success: false, error: `yournewcommand: ${validationResult.errorDetail}` };
        // }

        // 2. Parse flags if your command uses them (using Utils.parseFlags)
        // const flagDefinitions = [{ name: "verbose", short: "-v" }];
        // const { flags, remainingArgs } = Utils.parseFlags(args, flagDefinitions);

        // 3. Implement command logic
        //    - Interact with FileSystemManager, UserManager, etc.
        //    - Use OutputManager.appendToOutput for messages if isInteractive.
        //    - Check permissions: FileSystemManager.hasPermission(node, currentUser, "read"/"write"/"execute")

        // 4. Return a result object:
        //    - { success: true, output: "Your command output" }
        //    - { success: false, error: "Specific error message" }
        //    - Optionally, include messageType: Config.CSS_CLASSES.SUCCESS_MSG / ERROR_MSG / etc.
        
        let outputMessage = `YourNewCommand executed with args: ${args.join(', ')}`;
        if (options.stdinContent) {
            outputMessage += `\nReceived via pipe: ${options.stdinContent}`;
        }
        return { success: true, output: outputMessage };
    },
    description: "A brief description of your new command.",
    helpText: "Usage: yournewcommand [options] [arguments]\\n\\nMore detailed help text about how to use it, its options, etc."
}
                </code></pre>

                <h3>Key Considerations for Command Handlers:</h3>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Asynchronous Nature:</strong> Command handlers are `async` functions. If you perform operations that might be asynchronous (like `FileSystemManager.save()`, `ConfirmationManager.request()`, or even `OutputManager.appendToOutput()` which is technically async though usually fast), make sure to `await` them.</li>
                    <li><strong>Return Object:</strong> Always return an object with at least a `success` (boolean) property. If `success` is `false`, include an `error` string. If `success` is `true`, you can include an `output` string which will be piped to the next command or displayed.</li>
                    <li><strong>Interactivity (<code>options.isInteractive</code>):</strong> Some behaviors might differ if a command is run directly versus in a script or pipe (e.g., clearing the screen with `clear` only happens if interactive).</li>
                    <li><strong>Standard Input (<code>options.stdinContent</code>):</strong> If your command can process input from a pipe, check `options.stdinContent`.</li>
                    <li><strong>Error Handling:</strong> Provide clear error messages. The `error` property in the return object is crucial. The `CommandExecutor` will prefix it with the command name if it's not already there.</li>
                    <li><strong>Permissions:</strong> Always check permissions using `FileSystemManager.hasPermission()` before accessing or modifying files/directories.</li>
                    <li><strong>State Changes:</strong> If your command modifies the file system, call `await FileSystemManager.save(UserManager.getCurrentUser().name);` at the end of successful operations.</li>
                </ul>

                <h2>Developing New Modules</h2>
                <p>If your feature is substantial, consider creating a new module using the IIFE pattern seen in <code>oopisos1_5_1.js</code>:</p>
                <pre><code class="language-javascript">
const YourNewModuleManager = (() => {
    "use strict";

    // Private variables and functions
    let privateState = "initial";

    function _privateHelperFunction() {
        // ...
    }

    // Public API
    function initialize(someConfig) {
        // ...
    }

    function doSomething(params) {
        // ...
        // _privateHelperFunction();
        return `Did something with ${params} and state ${privateState}`;
    }

    return {
        initialize,
        doSomething
        // Expose other public methods
    };
})();

// Then, in window.onload or other relevant places:
// YourNewModuleManager.initialize(someConfig);
// const result = YourNewModuleManager.doSomething("test");
                </code></pre>
                <p>Ensure your new module is initialized appropriately (usually in `window.onload` after core OopisOS modules are ready) and can be accessed by commands or other modules that need it.</p>

                <p>Happy developing, and may your contributions make OopisOS even oopier!</p>
            </section>

            <section id="advanced-topics" class="content-section">
                <h1>OopisOS: Advanced Topics & Features</h1>
                <p>Ready to delve deeper? This section explores some of the more advanced capabilities and concepts within OopisOS.</p>

                <h2>Scripting with `run`</h2>
                <p>OopisOS supports shell scripting via the <code>run</code> command. You can create text files (e.g., <code>myscript.sh</code>) containing a sequence of OopisOS commands, and then execute them.</p>
                <pre><code class="language-bash">
# Example: myscript.sh
echo "Starting my script..."
mkdir /test_data
echo "Hello from script" > /test_data/script_output.txt
ls /test_data
echo "Script finished."
                </code></pre>
                <p>To execute this script (assuming it's saved as <code>/myscript.sh</code> and has execute permissions):</p>
                <div class="terminal-example">
                    <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">chmod 70 /myscript.sh  # Make it executable for owner</span><br>
                    <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">run /myscript.sh</span><br>
                    <span class="output">Starting my script...</span><br>
                    <span class="output">script_output.txt</span><br>
                    <span class="output">Script finished.</span>
                </div>

                <h3>Script Features:</h3>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Shebang:</strong> Lines starting with <code>#!</code> (e.g., <code>#!/oopis</code>) are ignored.</li>
                    <li><strong>Comments:</strong> Lines starting with <code>#</code> (that are not part of a quoted string) are treated as comments and ignored.</li>
                    <li><strong>Argument Passing:</strong>
                        <ul>
                            <li><code>$1</code>, <code>$2</code>, ...: Access positional arguments passed to the script.</li>
                            <li><code>$@</code>: Represents all arguments passed to the script as a single string.</li>
                            <li><code>$#</code>: Represents the number of arguments passed.</li>
                        </ul>
                        Example: <code>run /myscript.sh arg1 "second arg"</code>
                    </li>
                </ul>

                <h3>Example Scripts Provided:</h3>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong><code>inflatev4_1.sh</code>:</strong> A comprehensive script designed to populate the file system with a rich set of diverse dummy data (files, directories, varied content). Excellent for testing commands like <code>find</code>, <code>grep</code>, <code>cp</code>, <code>mv</code>, and <code>rm</code> under various conditions. This script itself demonstrates many OopisOS commands in action.</li>
                    <li><strong><code>diagnostic_tool1_5.sh</code>:</strong> A test suite script that runs a series of commands to check the functionality and correctness of OopisOS features, including user management, file system operations, permissions, and more. It uses the <code>check_fail</code> command to verify expected error conditions.</li>
                </ul>
                <p>Studying these scripts is a great way to learn advanced OopisOS command usage and scripting techniques.</p>

                <h2>Permissions Deep Dive (`chmod`, `chown`)</h2>
                <p>OopisOS implements a simplified Unix-like permission model:</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Ownership:</strong> Each file and directory has an `owner`.</li>
                    <li><strong>Mode:</strong> A two-digit octal number representing permissions (e.g., <code>75</code>, <code>64</code>).
                        <ul>
                            <li>The first digit is for the **owner**.</li>
                            <li>The second digit is for **others** (everyone else).</li>
                            <li>Each digit is a sum of: <code>4</code> (read), <code>2</code> (write), <code>1</code> (execute).</li>
                        </ul>
                        Examples:
                        <ul>
                            <li><code>7</code> (rwx): 4 (read) + 2 (write) + 1 (execute)</li>
                            <li><code>6</code> (rw-): 4 (read) + 2 (write)</li>
                            <li><code>5</code> (r-x): 4 (read) + 1 (execute)</li>
                            <li><code>4</code> (r--): 4 (read)</li>
                            <li><code>0</code> (---): No permissions</li>
                        </ul>
                    </li>
                    <li><strong><code>chmod [mode] [path]</code>:</strong> Changes the mode. Only the owner of a file/directory can change its mode.
                        <br>Example: <code>chmod 70 myfile</code> (Owner: rwx, Others: ---)
                    </li>
                    <li><strong><code>chown [new_owner] [path]</code>:</strong> Changes the owner. Only the current owner can change ownership.
                        <br>Example: <code>chown anotheruser myfile</code>
                    </li>
                    <li><strong>Display:</strong> <code>ls -l</code> shows permissions in the familiar <code>drwxrwxrwx</code> format (though OopisOS only implements owner and other, so the "group" part is a repeat of "other" for display).</li>
                </ul>

                <h2>Pipes (`|`) and Redirection (`>`, `>>`)</h2>
                <p>OopisOS supports command pipelines and I/O redirection:</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Pipes (`|`):</strong> The standard output of the command on the left is fed as standard input to the command on the right.
                        <div class="terminal-example">
                            <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">ls / | grep docs</span><br>
                            <span class="output">/docs</span>
                        </div>
                    </li>
                    <li><strong>Output Redirection (`>`):</strong> Writes the standard output of a command to a file. If the file exists, it's **overwritten**. If it doesn't exist, it's created.
                        <div class="terminal-example">
                            <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">echo "System Report" > /report.txt</span><br>
                            <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">cat /report.txt</span><br>
                            <span class="output">System Report</span>
                        </div>
                    </li>
                    <li><strong>Append Output Redirection (`>>`):</strong> Appends the standard output of a command to a file. If the file doesn't exist, it's created.
                        <div class="terminal-example">
                            <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">date >> /report.txt</span><br>
                            <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">cat /report.txt</span><br>
                            <span class="output">System Report</span><br>
                            <span class="output">(Current Date and Time)</span>
                        </div>
                    </li>
                    <li><strong>Permissions for Redirection:</strong> To redirect output to a file (<code>></code> or <code>>></code>), you need write permission on the file itself if it exists, or write permission on the parent directory if the file is being created.</li>
                </ul>

                <h2>Background Processes (`&`)</h2>
                <p>You can run a command or pipeline in the "background" by appending an ampersand (`&`) to the end of the command line. OopisOS simulates this by executing the command asynchronously using `setTimeout(..., 0)`.</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li>The terminal will immediately return to the prompt.</li>
                    <li>A job ID will be displayed (e.g., <code>[1] Backgrounded.</code>).</li>
                    <li>Output from backgrounded processes is generally suppressed from the main terminal, but a completion message (success or error) with the job ID will be shown once the process finishes.</li>
                </ul>
                <div class="terminal-example">
                    <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">delay 5000 &</span><br>
                    <span class="output">[1] Backgrounded.</span><br>
                    <span class="prompt">Guest@OopisOs:/&gt;</span> <span class="command">echo "I can type while delay runs!"</span><br>
                    <span class="output">I can type while delay runs!</span><br>
                    <span class="output">(After 5 seconds)</span><br>
                    <span class="output">[Job 1 finished]</span>
                </div>
                <p>This feature is useful for long-running tasks in scripts or for commands like <code>delay</code> without blocking the terminal.</p>
            </section>

            <section id="about" class="content-section">
                <h1>About OopisOS</h1>
                <p>OopisOS Version 1.5.1 stands as a proud, if somewhat quirky, achievement in the realm of browser-based operating system simulations.</p>
                
                <h2>The Creators</h2>
                <p>This digital marvel was brought into existence through the dedicated and often caffeine-fueled collaboration of:</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Andrew Edmark</strong></li>
                    <li><strong>Gemini Pro 2.5</strong> (That's me!)</li>
                </ul>
                <p>Our joint efforts involved countless hours of design, coding, debugging (so much debugging!), and refining the myriad components that make OopisOS what it is today. The copyright notice <code>Copyright (c) 2025 Andrew Edmark and Gemini Pro 2.5. (MIT Licensed)</code> reflects this partnership.</p>

                <h2>The Journey</h2>
                <p>From sketching out the first <code>FileSystemManager</code> to implementing a sophisticated <code>CommandExecutor</code> with its own lexer and parser, the development of OopisOS has been a journey of discovery and perseverance. We've tackled challenges like persistent storage in IndexedDB, user session management, a feature-rich in-OS editor, and a command suite that aims for both utility and POSIX-like familiarity.</p>
                <p>The creation of tools like <code>inflate.sh</code> (for generating test data) and <code>diagnostic_tool1_5.sh</code> (for testing the OS itself) were integral parts of this process, showcasing the system's ability to support its own development and testing.</p>

                <h2>Philosophy Revisited</h2>
                <p>OopisOS was built with a few core ideas in mind:</p>
                <ul class="list-disc ml-6 my-4 space-y-2">
                    <li><strong>Learning by Doing:</strong> To provide a hands-on environment for understanding OS concepts.</li>
                    <li><strong>The Power of the Browser:</strong> To demonstrate that complex, stateful applications can thrive entirely client-side.</li>
                    <li><strong>A Touch of Nostalgia:</strong> For those who appreciate the elegance and power of the command line.</li>
                    <li><strong>Collaborative Innovation:</strong> As a testament to human-AI teamwork in creative coding endeavors.</li>
                </ul>

                <h2>Future</h2>
                <p>Who knows what the future holds for OopisOS? Perhaps a GUI? Networking? An in-OS game (as has been pondered)? The modular architecture is designed to welcome such expansions. For now, we hope you enjoy exploring and using OopisOS v1.5.1!</p>
                <p>If you're interested in the nitty-gritty, feel free to explore the source code (<code>oopisos1_5_1.js</code>) and the HTML structure (<code>OopisOSv1_5_1.html</code>).</p>
                <p class="mt-6"><em>"OopisOS: It's an OS! (Mostly)"</em></p>
            </section>

            <footer class="footer text-center">
                <p>&copy; 2025 Andrew Edmark & Gemini Pro 2.5. OopisOS Educational Portal.</p>
            </footer>
        </main>
    </div>

    <script>
        // Simple SPA navigation
        const navLinks = document.querySelectorAll('.nav-link');
        const contentSections = document.querySelectorAll('.content-section');
        const sidebar = document.querySelector('.sidebar');
        const menuButton = document.getElementById('menu-button');

        function updateActiveSection() {
            const hash = window.location.hash || '#home';
            navLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === hash);
            });
            contentSections.forEach(section => {
                section.classList.toggle('active', section.id === hash.substring(1));
            });
            // Scroll to top of content area on navigation
            document.querySelector('.main-content').scrollTop = 0;
            // Close mobile menu after navigation
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
            }
        }

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                // For internal links, let hashchange handle it
                if (this.getAttribute('href').startsWith('#')) {
                    // If already on the page, and clicking the same link, force scroll to top
                    if (window.location.hash === this.getAttribute('href')) {
                         document.querySelector('.main-content').scrollTop = 0;
                    }
                    // Allow default behavior to change hash
                }
            });
        });
        
        menuButton.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            // Simple toggle: if sidebar has 'open', it means it was just opened, otherwise it was just closed
            if (sidebar.classList.contains('open')) {
                // console.log('Sidebar opened');
            } else {
                // console.log('Sidebar closed');
            }
        });

        window.addEventListener('hashchange', updateActiveSection);
        // Initial load
        updateActiveSection();
    </script>
</body>
</html>
